<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 2.0.45"/><script>window.__EMOTION_CRITICAL_CSS_IDS__ = ["tvsf5l","104xma1","otcyfv","1ejhn1u","6gxhc5","187t4uh","1aqhvl","yx7h9z"];</script><style>.css-tvsf5l{display:inline-block;color:#838383;font-size:28px;margin-top:8px;}.css-104xma1{color:#E0E0E0;margin:0 8px;}.css-104xma1:hover{color:#FAAA5E;}@import url(//fonts.googleapis.com/earlyaccess/notosanskr.css);html{background-color:#282828;}body,h1,h2,h3,h4,h5,h6,p,blockquote,pre,hr,dl,dd,ol,ul,figure{margin:0;padding:0;}body{font-family:'Noto Sans KR','Open Sans',sans-serif;font-size:18px;line-height:2.0;color:#D3D3D3;background-color:#282828;-webkit-text-size-adjust:100%;}h1,h2,h3,h4,h5,h6,p,blockquote,pre,ul,ol,dl,figure,%vertical-rhythm{margin-bottom:30px / 2;}img{max-width:100%;vertical-align:middle;}figure > img{display:block;}figcaption{font-size:NaN;}ul,ol{margin-left:30px;}li > ul,li > ol{margin-bottom:0;}h1,h2,h3,h4,h5,h6{font-weight:300;}a{-webkit-text-decoration:none;text-decoration:none;color:#747882;}a:hover{color:#FAAA5E;}blockquote{color:#828282;border-left:4px solid #afafaf;padding-left:30px / 2;font-size:18px;-webkit-letter-spacing:-1px;-moz-letter-spacing:-1px;-ms-letter-spacing:-1px;letter-spacing:-1px;font-style:italic;}blockquote >:last-child{margin-bottom:0;}pre,code{font-size:15px;border:1px solid #afafaf;border-radius:3px;}code{padding:1px 5px;}pre{padding:8px 12px;overflow-x:scroll;}pre > code{border:0;padding-right:0;padding-left:0;}.wrapper{max-width:-webkit-calc(640px - (30px * 2));max-width:calc(640px - (30px * 2));margin-right:auto;margin-left:auto;padding-right:30px;padding-left:30px;@extend %clearfix;}@include media-query(800px){max-width:-webkit-calc(640px}- (30px));max-width:calc(640px}- (30px));padding-right:30px / 2;padding-left:30px / 2;}/*|*/.icon > svg{display:inline-block;width:16px;height:16px;vertical-align:middle;}.icon > svg path{fill:$grey-color;}.site-header{min-height:56px;position:relative;}.site-title{font-size:26px;line-height:56px;-webkit-letter-spacing:-1px;-moz-letter-spacing:-1px;-ms-letter-spacing:-1px;letter-spacing:-1px;margin-bottom:0;float:left;}.site-title,.site-title:visited{color:darken(#828282,25%);}.site-footer{border-top:1px solid #afafaf;padding:30px 0;}.footer-heading{font-size:18px;margin-bottom:30px / 2;}.contact-list,.social-media-list{list-style:none;margin-left:0;}.rss-subscribe{text-align:right;}.footer-col-wrapper{font-size:18px - 3;color:#828282;margin-left:-30px / 2;@extend %clearfix;}.footer-col{float:left;margin-bottom:30px / 2;padding-left:30px / 2;}.footer-col-1{width:-webkit-calc(35% - (#{30px}/ 2));width:calc(35% - (#{30px}/ 2));}.footer-col-2{width:-webkit-calc(20% - (#{30px}/ 2));width:calc(20% - (#{30px}/ 2));}.footer-col-3{width:-webkit-calc(45% - (#{30px}/ 2));width:calc(45% - (#{30px}/ 2));}@include media-query(800px).footer-col-1,.footer-col-2{width:-webkit-calc(50% - (#{30px}/ 2));width:calc(50% - (#{30px}/ 2));}.footer-col-3{width:-webkit-calc(100% - (#{30px}/ 2));width:calc(100% - (#{30px}/ 2));}/*|*/@include media-query($on-palm).footer-col{float:none;width:-webkit-calc(100% - (#{30px}/ 2));width:calc(100% - (#{30px}/ 2));}/*|*/.page-content{padding:30px 0;}.page-heading{font-size:18px;font-weight:bold;}.post-list{margin-left:0;list-style:none;}.post-list > li{margin-bottom:0;}.archive-group{margin-left:0;list-style:none;}.archive-group > li{margin-bottom:0;}.post-meta{font-size:NaN;color:#828282;float:right;font-size:0.8em;}.post-link{font-size:0.88em;font-weight:400;}.post-desc{margin:0 0 10px 14px;font-size:0.76em;color:#999;font-weight:300;}.post-header{margin-bottom:30px;}.post-header .post-meta{font-size:NaN;color:#828282;float:none;}.post-title{font-size:42px;-webkit-letter-spacing:-1px;-moz-letter-spacing:-1px;-ms-letter-spacing:-1px;letter-spacing:-1px;line-height:1;}@include media-query(800px){font-size:36px;}/*|*/.post-content{margin-bottom:30px;font-size:16px;}.post-content h1{padding-top:20px;}.post-content h2{font-size:30px;}@include media-query(800px){font-size:28px;}/*|*/.post-content h3{font-size:26px;}@include media-query(800px){font-size:22px;}/*|*/.post-content h4{font-size:20px;}@include media-query(800px){font-size:18px;}/*|*/.post-content hr{border:none;border-top:1px solid #828282;margin-top:30px;}.post-content p{margin:20px 0;}.css-6gxhc5{height:120px;}.css-187t4uh{color:#E0E0E0;float:right;margin:18px 0;}.css-1aqhvl{padding:20px 0;line-height:normal;}.css-yx7h9z{display:block;color:#838383;font-size:1em;margin-top:8px;text-align:right;}</style><title data-react-helmet="true">eeearl - 갤러리에서 Picasa나 Google+의 Sync된 이미지를 가져오는 방법</title><link data-react-helmet="true" rel="canonical" href="https://eeearl.com//2014-04-03-android-get-picasa-images"/><meta data-react-helmet="true" name="description" content="small talk for life live love and programing"/><meta data-react-helmet="true" property="og:url" content="https://eeearl.com//2014-04-03-android-get-picasa-images"/><meta data-react-helmet="true" property="og:type" content="article"/><meta data-react-helmet="true" property="og:title" content="갤러리에서 Picasa나 Google+의 Sync된 이미지를 가져오는 방법"/><meta data-react-helmet="true" property="og:description" content="small talk for life live love and programing"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><meta data-react-helmet="true" name="twitter:creator" content="@eeeearl"/><meta data-react-helmet="true" name="twitter:title" content="갤러리에서 Picasa나 Google+의 Sync된 이미지를 가져오는 방법"/><meta data-react-helmet="true" name="twitter:description" content="small talk for life live love and programing"/><link rel="alternate" type="application/rss+xml" title="Gatsby RSS Feed" href="/rss.xml"/><link as="script" rel="preload" href="/0-aaeaf1dbc1cd454441e0.js"/><link as="script" rel="preload" href="/component---src-templates-blog-template-js-b824d5da85c105236318.js"/><link as="script" rel="preload" href="/app-c3869af50a55a86a4641.js"/><link as="script" rel="preload" href="/webpack-runtime-c508b025013b67ec462f.js"/><link rel="preload" href="/static/d/113/path---2014-04-03-android-get-picasa-images-359-b91-xXqBXUpnYnpudEmCmnO5tDPO7U.json" as="fetch" crossOrigin="use-credentials"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group"><header class="wrapper css-6gxhc5 e3rsph00"><a class="css-tvsf5l" href="/">eeearl</a><div class="css-187t4uh e3rsph01"><a class="css-104xma1" href="/about">about</a><a class="css-104xma1" href="/blog">blog</a></div></header><div class="post-content"><div class="wrapper"><h5>2014 Apr 03</h5><h1 class="css-1aqhvl e1q6z0350">갤러리에서 Picasa나 Google+의 Sync된 이미지를 가져오는 방법</h1><div class="blog-post-content"><p>안드로이드에서 Intent를 사용해 갤러리나 사진앱을 통해 사진의 Uri를 가져오는 코드는 이렇습니다. </p>
<pre><code>Intent intent = new Intent(Intent.ACTION_PICK);  
intent.setType(MediaStore.Images.Media.CONTENT_TYPE);  
startActivityForResult(intent, 1000); 
</code></pre>
<p>,</p>
<pre><code>@Override
protected void onActivityResult(int requestCode, int resultCode, Intent data) {
    Uri imageUri = data.getData();
    Bitmap bitmap = BitmapFactory.decodeFile(getPath(imageUri));
}
public String getPath(Uri uri) {
    String[] projection = {MediaStore.Images.Media.DATA};
    String result = null
    CursorLoader cursorLoader = new CursorLoader(this, uri, projection, null, null, null);
    Cursor cursor = cursorLoader.loadInBackground();
    if (cursor != null) {
        int columnIndex = cursor.getColumnIndexOrThrow(MediaStore.Images.Media.DATA);
        cursor.moveToFirst();
        result = cursor.getString(columnIndex);
    }
        return result;
}
</code></pre>
<p>파일로 읽어오기 때문에 퍼미션도 줘야 합니다.</p>
<p>간단하게(?) 이정도면 내장된 이미지를 Bitmap으로 가져올 수 있습니다.</p>
<p>그런데 이렇게 해서 못가져오는 이미지가 있는데.. 갤러리에서 Picasa의 싱크되어있는 이미지를 선택하게 되면 에러가 나게 됩니다. 이땐 다른 방법을 사용해야 합니다.</p>
<p>에러의 이유는 갤러리에서 가져온 Uri의 위치 때문입니다.</p>
<p>picasa에 sync된 이미지를 썸네일로 보여주는 건 캐싱되어 있을 것이지만 실제 파일은 서버에 있을테니 Uri 주소는 다른 사진의 Uri와 다른 주소를 가지고 있습니다.</p>
<p><strong>일반적인 이미지 Uri</strong> “content://media/external/images/media/122733″<br>
<strong>Sync된 이미지 Uri</strong> “content://com.google.android.gallery3d.provider/picasa/item/122733″  </p>
<p>보통 이미지의 Uri는 메모리의 위치를 가지고 있지만 Sync 된 이미지의 Uri는 앱의 위치를 가지고 있습니다…</p>
<p>그래서 해결방법은</p>
<pre><code>@Override
 protected void onActivityResult(int requestCode, int resultCode, Intent data) {
     Uri uri = data.getData();
     String[] projection = {MediaStore.Images.Media.DATA};
     CursorLoader cursorLoader = new CursorLoader(this, uri, projection, null, null, null);
     Cursor cursor = cursorLoader.loadInBackground();
     if (cursor != null) {
         cursor.moveToFirst();
     }
     Bitmap outBitmap = null;
     File file = new File(Environment.getExternalStorageDirectory(), "photo.jpg");
     InputStream input = null;
     OutputStream output = null;
     try {
         input = getContentResolver().openInputStream(uri);
         output = new FileOutputStream(file);
         copyStream(input, output);
         output.close();
         outBitmap = BitmapFactory.decodeStream(new FileInputStream(file));
         output.close();
         input.close();
     } catch (FileNotFoundException e) {
         e.printStackTrace();
     } catch (IOException e) {
         e.printStackTrace();
     }
    cursor.close();
}
</code></pre>
<p>이걸보고 앞에 Cursor를 왜 썼는지 궁금해 하실 수도 있을거 같습니다. 저 Cursor를 쓰지 않으면 FileNotFound 에러를 던집니다. Cursor로 가리키고 있어야 파일로 읽을 수 있는것입니다.</p>
<p>그리고 임시의 파일에 스트림을 사용해서 이미지를 저장하고 그 파일을 읽어오는 방법입니다.</p>
<p>코드가 조금 길어졌지만 파일로 캐싱 후 이미지를 로딩하는 방법이 필요하다면 이 방법 을 사용하시면 되겠습니다.</p>
<p>파일캐싱이 필요없다면!!</p>
<p>굉장히 짧은 코드로 끝납니다..</p>
<pre><code>try {
    InputStream is = getContentResolver().openInputStream(imageUri);
    Bitmap bitmap = BitmapFactory.decodeStream(is);
} catch (FileNotFoundException e) {
    e.printStackTrace();
}
</code></pre>
<p>앞서 설명했던 코드를 보시고 이 코드를 보시면 이해하기 수월하실 수도 있습니다;;</p>
<p>BitmapFactory 클래스에서 바로 스트림으로 부터 디코딩을 해주는 메소드가 있어서 그걸 쓰면 코드가 짧아집니다;</p>
<p>위의 긴 코드로 구현했던 부분은 input스트림과 output스트림을 모두 직접 구현한 것이고, BitmapFactory 클래스엔 위에 구현한 것이 이미 구현된 것이라 보시면 되겠네요 개발 방향에 따라 좋은방향으로 사용하면 되겠습니다.</p>
<blockquote>예제로 보여드린 코드는 안드로이드에서 실제 구현하실 때 비동기로 구현하셔야 문제가 없습니다.</blockquote></div></div></div><footer class="wrapper css-6gxhc5 et2kv7a0"><div class="css-yx7h9z et2kv7a1">eeearl.com</div></footer></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'undefined', 'auto', {});
      
      }
      </script><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-templates-blog-template-js","jsonName":"2014-04-03-android-get-picasa-images-359","path":"/2014-04-03-android-get-picasa-images"};window.dataPath="113/path---2014-04-03-android-get-picasa-images-359-b91-xXqBXUpnYnpudEmCmnO5tDPO7U";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-c3869af50a55a86a4641.js"],"component---src-templates-blog-template-js":["/component---src-templates-blog-template-js-b824d5da85c105236318.js"],"component---src-pages-about-js":["/component---src-pages-about-js-0b3fef319ebf0f29a030.js"],"component---src-pages-blog-js":["/component---src-pages-blog-js-d8caf52beaff8e74da86.js"],"component---src-pages-index-js":["/component---src-pages-index-js-efc5f66f0d421a0f85f8.js"]};/*]]>*/</script><script src="/webpack-runtime-c508b025013b67ec462f.js" async=""></script><script src="/app-c3869af50a55a86a4641.js" async=""></script><script src="/component---src-templates-blog-template-js-b824d5da85c105236318.js" async=""></script><script src="/0-aaeaf1dbc1cd454441e0.js" async=""></script></body></html>